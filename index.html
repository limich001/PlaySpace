<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<div id="container" style="width: 500px; height: 500px;"></div>
<form id="target">
	<input name="types" type="radio" value="a"> ボーリング
	<input name="types" type="radio" value="b"> カジノ
	<input name="types" type="radio" value="c"> 温泉
</form>
<script type="text/javascript">
    var container = document.getElementById("container");
  
    navigator.geolocation.getCurrentPosition(successCallback, errorCallback);

    /***** ユーザーの現在の位置情報を取得 *****/
    function successCallback(position) {
        //現在位置を取得する
        var map = new google.maps.Map(container, {
        zoom: 17,
        center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
        });

        //現在位置をマークする
        var marker = new google.maps.Marker({
            position: {lat:position.coords.latitude, lng:position.coords.longitude},
            map: map
        });

        //選択した遊びの種類に基づいてマークを表示する
        // form要素を取得
        var element = document.getElementById( "target" ) ;

        // form要素内のラジオボタングループ(name="types")を取得
        var radioNodeList = element.types ;

        // 選択状態の値(value)を取得 (Bが選択状態なら"b"が返る)
        var type = radioNodeList.value ;

        if ( type === "" ) {
            // 未選択状態
        } else {
            // typeには選択状態の値が代入されている
            if(type === "ボーリング"){
                startNearbySearch(new google.maps.LatLng(position.coords.latitude, position.coords.longitude), 'bowling_alley');
            }else if(type === "カジノ"){
                startNearbySearch(new google.maps.LatLng(position.coords.latitude, position.coords.longitude), 'casino');
            }else if(type === "温泉"){
                startNearbySearch(new google.maps.LatLng(position.coords.latitude, position.coords.longitude), 'spa');
            }
            
        }

    }

    /***** 位置情報が取得できない場合 *****/
    function errorCallback(error) {
        var err_msg = "";
        switch(error.code)
        {
            case 1:
            err_msg = "位置情報の利用が許可されていません";
            break;
            case 2:
            err_msg = "デバイスの位置が判定できません";
            break;
            case 3:
            err_msg = "タイムアウトしました";
            break;
        }
        document.getElementById("show_result").innerHTML = err_msg;
        //デバッグ用→　document.getElementById("show_result").innerHTML = error.message;
    }
    
    /*
    位置情報を使って周辺検索
    latLng : 位置座標（google.maps.LatLng）
    */
    function startNearbySearch(latLng, keywordOfplayspace){
    
        //読み込み中表示
        document.getElementById("results").innerHTML = "Now Loading...";
        
        //Mapインスタンス生成
        var map = new google.maps.Map(
            document.createElement("div")
        );
        
        //PlacesServiceインスタンス生成
        var service = new google.maps.places.PlacesService(map);
        
        //周辺検索
        service.nearbySearch(
            {
            location: latLng,
            radius: 800,
            type: [keywordOfplayspace],
            keyword: '',
            language: 'ja'
            },
            displayResults
        );
    }

</script>